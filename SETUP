
Using the unofficial patchset from Gavin Lambert gavin.lambert@tomra.com:

https://sourceforge.net/u/uecasm/etherlab-patches/ci/default/tree/#readme

hg clone http://hg.code.sf.net/p/etherlabmaster/code etherlab
hg clone http://hg.code.sf.net/u/uecasm/etherlab-patches etherlab/.hg/patches

cd etherlab
hg qpush -a

Build and Compile:

sudo apt install automake libtool

./bootstrap
./configure --enable-tty --enable-8139too=no
make all
sudo make modules

Fehler von init_timer (Kernel 4.14) init_setup (Kernel 4.15), patch siehe unten
/home/dev/workspace/EtherCAT/EtherCAT/examples/mini/mini.c:495:5: error: implicit declaration of function ‘init_timer’; did you mean ‘init_timers’? [-Werror=implicit-function-declaration]

Fehler von struct vm_operations_struct { .. int (*fault)(struct vm_area_struct *vma, struct vm_fault *vmf); .. } (KERNEL 4.10)
           struct vm_operations_struct { .. int (*fault)(struct vm_fault *vmf); .. }                             (KERNEL 4.15) , patch siehe unten
/home/dev/workspace/EtherCAT/EtherCAT/master/cdev.c:87:14: error: initialization from incompatible pointer type [-Werror=incompatible-pointer-types]

Fehler von struct vm_fault (KERNEL 4.9) und struct vm_fault (KERNEL 4.15)
/home/dev/workspace/EtherCAT/EtherCAT/master/cdev.c:278:46: error: ‘struct vm_fault’ has no member named ‘virtual_address’

make modules

Fehler von struct sched_param (KERNEL 4.10) und struct sched_param (KERNEL 4.15)
/home/dev/workspace/EtherCAT/EtherCAT/master/master.c:1649:12: error: variable ‘param’ has initializer but incomplete type

4.10 /include/linux/sched.h
4.18 /include/uapi/linux/sched/types.h


sudo make modules_install install
sudo depmod

# systemd
sudo ln -s /opt/etherlab/sbin/ethercatctl /usr/local/sbin/
sudo ln -s /opt/etherlab/bin/ethercat /usr/local/bin/
sudo ln -s /opt/etherlab/etc/ethercat.conf /etc/
sudo nano /etc/ethercat.conf

MASTER0_DEVICE="00:e0:4b:5e:0b:3e"  # MAC-Addresse eintragen
DEVICE_MODULES="generic"            # Driver eintragen

# init.d (ungetestet)
sudo ln -s /opt/etherlab/etc/init.d/ethercat /etc/init.d/
sudo ln -s /opt/etherlab/bin/ethercat /usr/local/bin/
sudo mkdir /etc/sysconfig
sudo ln -s /opt/etherlab/etc/sysconfig/ethercat /etc/sysconfig/
sudo nano /etc/sysconfig/ethercat

nano /etc/udev/rules.d/99-EtherCAT.rules
KERNEL=="EtherCAT[0-9]*", SUBSYSTEM=="EtherCAT", MODE="0666", GROUP="users"
# für den Fall das das TTY Beispiel verwendet wird
KERNEL=="ttyEC[0-9]", SUBSYSTEM=="tty", MODE="0666", GROUP="users"


